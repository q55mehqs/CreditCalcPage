{% extends "main_base.html.jinja2" %}

{% block class_script %}
<script>
  select_credits = {{ select_credits|tojson }};

  function updateCount(){
    must_general = {{ must_general }};
    must_special = {{ must_special }};
    must_gakushu = {{ must_gakushu }};
    gen = must_general;
    spe = must_special;
    gak = must_gakushu;

    const select_credits_checkbox = document.creditForm.credits;
    for(let i = 0; i < select_credits_checkbox.length; i++) {
      if(select_credits_checkbox[i].checked) {
        let split = select_credits_checkbox[i].value.split(' ')
        select_credit = select_credits[split[0]][split[1]]

        if(select_credit.専門) {
          spe += select_credit.単位数;
        }
        else {
          gen += select_credit.単位数;
        }
        if(select_credit.学修) {
          gak += select_credit.単位数;
        }
      }
    }

    document.getElementById("general").textContent = gen;
    if (gen >= 75) {
      document.getElementById("general").style.color = "green";
    }
    else {
      document.getElementById("general").style.color = "red";
    }

    document.getElementById("special").textContent = spe;
    if (spe >= 82) {
      document.getElementById("special").style.color = "green";
    } else {
      document.getElementById("special").style.color = "red";
    }

    document.getElementById("total").textContent = gen + spe;
    if (gen + spe >= 167) {
      document.getElementById("total").style.color = "green";
    } else {
      document.getElementById("total").style.color = "red";
    }

    document.getElementById("gakushu").textContent = gak;
    if (gak > 60) {
      document.getElementById("gakushu").style.color = "red";
    }
    else if (gak == 60) {
      document.getElementById("gakushu").style.color = "orange";
    }
    else {
      document.getElementById("gakushu").style.color = "black";
    }
  }
</script>
{% endblock %}

{% block form %}
  {% for class_credit in select_credits %}
    {% set outer_index = loop.index0 %}
    <h4>{{ loop.index }}年</h4>
    <ul>
      {% for credit in class_credit %}
        <li>
          <label for="credit_clicks_{{ outer_index }}{{ loop.index0 }}">
            <input type="checkbox" name="credits" id="credit_clicks_{{ outer_index }}{{ loop.index0 }}"
                    value="{{ outer_index }} {{ loop.index0 }}" onchange="updateCount()">
            {{ credit.単位数 }}単位 

            {% if credit.専門 %}
              <span style="border: 1px solid; background-color: lightskyblue;">専門</span>
            {% else %}
              <span style="border: 1px solid; background-color: lightsalmon;">一般</span>
            {% endif %}

            {% if credit.学修 %}
              <span style="border: 1px solid; background-color: darkseagreen;">学修</span>
            {% else %}
              <span style="border: 1px solid;">履修</span>
            {% endif %}

            {{ credit.教科名 }}
          </label>
        </li>
      {% endfor %}
    </ul>
  {% endfor %}
{% endblock %}

{% block calc %}
    <ul>
      <li><span style="background-color: lightsalmon;">一般科目</span>(75+): <span id="general" style="color: red;">{{ must_general }}</span></li>
      <li><span style="background-color: lightskyblue;">専門科目</span>(82+): <span id="special" style="color: red;">{{ must_special }}</span></li>
      {% set total = must_general + must_special %}
      <li>合計(167+): <span id="total" style="color: red;">{{ total }}</span></li>
      <li><span style="background-color: darkseagreen;">学修単位</span>(60-): <span id="gakushu" style="color: black;">{{ must_gakushu }}</span></li>
    </ul>
{% endblock %}